#!/bin/bash
  
##############################################################################
# run-minidlna, by Steven Saus 20 Sep 2022
#
# For setting up and running minidlna inside a docker-compose setup
#
# steven@faithcollapsing.com
# Licensed under the Apache License
##############################################################################  

set -e

echo "Starting minidlna setup"

##############################################################################
# Exports
##############################################################################
export XDG_CONFIG_HOME=/usr/local/share
export XDG_STATE_HOME=/usr/local/state
export MPD_HOST=mycomplicatedpassword@localhost

if [ -f /media/config/minidlna.conf ];then 
    cp -f /media/config/minidlna.conf /etc
fi

# unclear if this is needed.
chown $USER /var/run/minidlna

# minidlnad is in different locations based on distro.
mini_binary=$(which minidlnad)
# -S is for nonforking, -v is verbose. 
echo "Starting ${mini_binary}"
${mini_binary} -S -v 
